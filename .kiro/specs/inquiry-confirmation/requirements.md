# お問い合わせ確認画面機能 - 要件定義書

## 概要

お問い合わせフォームに確認画面を追加し、ユーザーが入力内容を確認してから送信できるようにする機能です。

## 要件

### 要件1: お問い合わせフォームの確認ボタン

**ユーザーストーリー:** お客様として、お問い合わせ内容を送信前に確認したいので、確認画面で内容をチェックできるようにしたい

#### 受入基準

1. WHEN お客様がお問い合わせフォームに必要事項を入力して「確認する」ボタンをクリック THEN バリデーションが実行される
2. IF 入力内容にエラーがある THEN エラーメッセージが表示され、フォーム画面に留まる
3. IF 入力内容が正しい THEN 確認画面（inquiries/confirm）に遷移する
4. WHEN 確認画面に遷移 THEN 入力された全ての内容が表示される

### 要件2: 確認画面の表示

**ユーザーストーリー:** お客様として、入力した内容を確認画面で見直したいので、見やすい形式で表示してほしい

#### 受入基準

1. WHEN 確認画面が表示される THEN 以下の項目が表形式で表示される
   - お名前
   - フリガナ  
   - メールアドレス
   - お問い合わせ区分（ラジオボタンの選択内容）
   - 電話番号
   - ご住所
   - お問い合わせ内容
2. WHEN 確認画面が表示される THEN 「戻る」ボタンと「送信する」ボタンが表示される
3. WHEN 「戻る」ボタンをクリック THEN 入力内容を保持したままフォーム画面に戻る

### 要件3: 確認画面からの送信処理

**ユーザーストーリー:** お客様として、確認画面で内容を確認後に送信したいので、送信ボタンで実際の送信処理を実行したい

#### 受入基準

1. WHEN 確認画面で「送信する」ボタンをクリック THEN お問い合わせデータがデータベースに保存される
2. WHEN データベース保存が成功 THEN お客様向け受付メールが送信される
3. WHEN データベース保存が成功 THEN 管理者向け通知メールが送信される
4. WHEN 送信処理が完了 THEN 完了画面に遷移し、成功メッセージが表示される
5. IF 送信処理でエラーが発生 THEN エラーメッセージを表示し、確認画面に留まる

### 要件4: セッション管理

**ユーザーストーリー:** システムとして、確認画面と送信処理の間で入力データを安全に保持したい

#### 受入基準

1. WHEN フォームから確認画面に遷移 THEN 入力データがセッションに一時保存される
2. WHEN 確認画面から戻る THEN セッションからデータを復元してフォームに表示される
3. WHEN 送信処理が完了 THEN セッションから一時データが削除される
4. WHEN セッションが無効または存在しない THEN フォーム画面にリダイレクトされる

### 要件5: バリデーション

**ユーザーストーリー:** システムとして、不正なデータの送信を防ぎたい

#### 受入基準

1. WHEN 確認画面への遷移時 THEN 全ての必須項目のバリデーションが実行される
2. WHEN 送信処理実行時 THEN 再度バリデーションが実行される
3. IF バリデーションエラーが発生 THEN 適切なエラーメッセージが表示される
4. WHEN バリデーションが成功 THEN 処理が続行される